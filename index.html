<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seafoam E‑Card — Interactive Demos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ===== base ===== */
    *{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif}
    body{background:#f0f4f4;min-height:100vh;display:flex;flex-direction:column;color:#333}

    /* ===== header ===== */
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#A8E6CF;border-bottom:2px solid #82C9A1}
    header h1{font-size:1.5rem;font-weight:700;color:#155f46}
    .pill{background:#60A085;color:#fff;padding:.6rem 1.6rem;border:none;border-radius:9999px;font-weight:600;cursor:pointer;text-decoration:none;transition:.2s}
    .pill:hover{filter:brightness(1.1)}

    /* ===== main layout ===== */
    main{flex:1;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:2.5rem}
    .demos{display:grid;gap:2rem;width:100%;max-width:1100px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
    .demo{background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.1);padding:1.5rem;display:flex;flex-direction:column;align-items:center}
    .demo h3{margin-bottom:.75rem;font-size:1.1rem;font-weight:600;color:#155f46}
    .demo iframe{width:100%;aspect-ratio:16/10;border:2px solid #ccc;border-radius:12px;overflow:hidden}

    /* visual spark for copy */
    .spark{position:absolute;width:8px;height:8px;background:#ffcc00;border-radius:50%;pointer-events:none;animation:spark 1s forwards}
    @keyframes spark{0%{transform:scale(0);opacity:1}80%{transform:scale(1.6);opacity:1}100%{transform:scale(0);opacity:0}}
  </style>
</head>
<body>

  <!-- ==================== HEADER ==================== -->
  <header>
    <h1>Seafoam E‑Card</h1>
    <a href="builder.html" class="pill">Create E‑Card</a>
  </header>

  <!-- ==================== DEMOS ==================== -->
  <main>
    <section class="demos">

      <!-- BUILD -->
      <div class="demo">
        <h3>1 · Build</h3>
        <iframe id="frameBuild" src="builder.html"></iframe>
      </div>

      <!-- PREVIEW -->
      <div class="demo">
        <h3>2 · Preview</h3>
        <iframe id="framePreview" title="Preview demo"></iframe>
      </div>

      <!-- SHARE -->
      <div class="demo" style="position:relative">
        <h3>3 · Share</h3>
        <iframe id="frameShare" src="builder.html"></iframe>
      </div>

    </section>
  </main>

  <!-- ==================== SCRIPT ==================== -->
  <script>
  /* helpers */
  const delay = ms => new Promise(r=>setTimeout(r,ms));

  /* -------------------------------------------------- */
  /*  DEMO 1  :  run the Builder and capture its link   */
  /* -------------------------------------------------- */
  const cardData = {
    to   : 'Sam',
    from : 'Kim',
    lines: ['You rock!', 'Enjoy your day', 'Dream big', '— The Team —'],
    colors:{body:'#A8E6CF',flap:'#76C69C',paper:'#fff8e7',bg:'#f0f0f0'},
    sticker:'https://picsum.photos/120'       // small hosted image
  };

  const buildLoop = async (frame, withCopy)=>{            /* withCopy = false for demo1, true for demo3 */
    const win  = frame.contentWindow;
    const doc  = win.document;

    /* wait until inner page finished loading */
    if(!doc.getElementById('toField')){ await delay(200); return buildLoop(frame,withCopy); }

    /* 1. clear & type lines */
    const linesUl = doc.getElementById('lines');
    [...linesUl.querySelectorAll('li')].forEach(li=>li.remove());  // start fresh
    const addLineBtn = doc.getElementById('addLine');
    for(const text of cardData.lines){
      addLineBtn.click();                     // adds LI with input
      const inp = linesUl.lastElementChild.querySelector('input');
      inp.value = text;
      inp.dispatchEvent(new Event('input',{bubbles:true}));
      await delay(250);
    }

    /* 2. fill TO / FROM */
    const toF   = doc.getElementById('toField');
    const fromF = doc.getElementById('fromField');
    toF.value   = cardData.to;   toF.dispatchEvent(new Event('input',{bubbles:true}));
    fromF.value = cardData.from; fromF.dispatchEvent(new Event('input',{bubbles:true}));

    /* 3. paste sticker URL */
    const urlF  = doc.getElementById('stickerUrl');
    urlF.value  = cardData.sticker;
    urlF.dispatchEvent(new Event('input',{bubbles:true}));
    await delay(300);

    /* 4. press Generate */
    doc.getElementById('generate').click();
    await delay(500);

    /* 5. retrieve link */
    const link = doc.getElementById('shareLink').textContent.trim();

    /* optional copy highlight */
    if(withCopy){
      const copyBtn = doc.getElementById('copyBtn');
      copyBtn.click();
      copyHighlight(frame);                 // spark + flash in host page
    }

    return link;
  };

  function copyHighlight(containerFrame){
    /* Spark effect inside main page (not inside iframe) */
    const rect = containerFrame.getBoundingClientRect();
    const spark = document.createElement('div');
    spark.className='spark';
    spark.style.left = rect.left + rect.width*0.8 + 'px';
    spark.style.top  = rect.top  + rect.height*0.15 + 'px';
    document.body.appendChild(spark);
    setTimeout(()=>spark.remove(),1000);
  }

  /* run the first builder demo once the iframe is ready */
  (async ()=>{
    const link = await buildLoop(document.getElementById('frameBuild'),false);

    /* -------------------------------------------------- */
    /*  DEMO 2 : show the card & auto‑scroll continuously */
    /* -------------------------------------------------- */
    const prevFrame = document.getElementById('framePreview');
    prevFrame.src = link;

    prevFrame.onload = async ()=>{
      const pWin = prevFrame.contentWindow;
      for(;;){
        pWin.scrollTo({top:0,behavior:'instant'});
        await delay(100);
        /* smooth scroll down to trigger open/unroll */
        pWin.scrollTo({top:pWin.document.body.scrollHeight,behavior:'smooth'});
        await delay(6500);                  // wait for envelope cycle
      }
    };

    /* -------------------------------------------------- */
    /*  DEMO 3 : rebuild & click Copy every 6 s           */
    /* -------------------------------------------------- */
    const shareFrame = document.getElementById('frameShare');
    shareFrame.onload = async()=>{
      for(;;){
        await buildLoop(shareFrame,true);
        await delay(6000);
        shareFrame.contentWindow.location.reload();
        await delay(500);
      }
    };
  })();
  </script>

</body>
</html>
