<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E‑Card Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --body:#A8E6CF; --flap:#76C69C; --paper:#fff8e7;
      --body-border:#82C9A1; --flap-border:#60A085; --bg:#f0f0f0;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif}
    body{background:var(--bg);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:2rem;gap:2rem}
    h1{font-weight:700}
    form{display:grid;gap:1rem;width:100%;max-width:520px}
    label{font-size:.9rem;font-weight:600;display:block}
    input[type="text"]{width:100%;padding:.6rem 1rem;border:1px solid #ccc;border-radius:9999px}
    input[type="color"]{border:none;width:2.75rem;height:2.75rem;border-radius:50%;cursor:pointer;appearance:none}
    #lines li{display:flex;gap:.5rem;margin:.35rem 0}
    #lines input{flex:1}
    button{padding:.6rem 1.4rem;border:none;border-radius:9999px;background:#60A085;color:#fff;font-weight:600;cursor:pointer}
    .addLineBtn{background:#76C69C;font-size:.85rem;padding:.35rem 1rem}
    #previewWrap{border:1px dashed #bbb;border-radius:8px;padding:1rem;margin-top:1rem}
    iframe{width:100%;aspect-ratio:4/3;border:none;border-radius:6px}
    #linkWrap{margin-top:1rem;display:none}
    #linkField{width:100%;padding:.6rem 1rem;border:1px solid #ccc;border-radius:9999px;background:#f7f7f7}
  </style>
</head>
<body>

<h1>Create Your Seafoam Envelope E‑Card</h1>

<form id="cardForm">
  <label>Square sticker URL
    <input type="text" id="stickerUrl" placeholder="https://…">
  </label>

  <label>Message lines
    <ul id="lines"></ul>
    <button type="button" class="addLineBtn" id="addLine">+ Add line</button>
  </label>

  <label>To <input type="text" id="toField"></label>
  <label>From <input type="text" id="fromField"></label>

  <label>Body colour <input type="color" id="bodyCol" value="#A8E6CF"></label>
  <label>Flap colour <input type="color" id="flapCol" value="#76C69C"></label>
  <label>Paper colour <input type="color" id="paperCol" value="#fff8e7"></label>
  <label>Background colour <input type="color" id="bgCol" value="#f0f0f0"></label>

  <button type="button" id="generate">Generate Link</button>
</form>

<div id="linkWrap">
  <input id="linkField" readonly>
</div>

<div id="previewWrap">
  <iframe id="preview" title="Preview"></iframe>
</div>

<script>
/* ---------- line management ---------- */
const addLineBtn=document.getElementById('addLine');
const linesUl   =document.getElementById('lines');
addLineBtn.onclick=()=>{const li=document.createElement('li');
  li.innerHTML='<input type=text><button class="addLineBtn">✕</button>';
  li.lastChild.onclick=()=>li.remove();
  linesUl.appendChild(li);
  refreshPreview();
};

/* ---------- refresh triggers ---------- */
['stickerUrl','toField','fromField','bodyCol','flapCol','paperCol','bgCol']
  .forEach(id=>document.getElementById(id).addEventListener('input',refreshPreview));
linesUl.addEventListener('input',refreshPreview);

/* ---------- collect builder state ---------- */
function collect(){
  return{
    to  :toField.value.trim(),
    from:fromField.value.trim(),
    lines:[...linesUl.querySelectorAll('input[type="text"]')]
             .map(i=>i.value.trim()).filter(Boolean),
    colors:{
      body:bodyCol.value,flap:flapCol.value,
      paper:paperCol.value,bg:bgCol.value
    },
    sticker:stickerUrl.value.trim()
  };
}

/* ---------- preview iframe ---------- */
function viewerCSS(){return`
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:var(--bg);min-height:1800vh}
.envelope{position:fixed;top:65%;left:50%;width:60vw;height:60vh;transform:translate(-50%,-50%);perspective:800px}
.paper{position:absolute;bottom:2px;left:2px;width:calc(100% - 4px);height:auto;background:var(--paper);padding:2rem 1rem 2rem;text-align:center}
.line{margin:1rem 0;font-size:1.25rem;}
.body{position:absolute;top:0;left:0;width:100%;height:100%;background:var(--body);border:2px solid var(--body-border)}
.flap{position:absolute;top:0;left:0;width:100%;height:50%;background:var(--flap);border:2px solid var(--flap-border);clip-path:polygon(0 0,100% 0,50% 100%)}
.mask{position:absolute;bottom:2px;left:2px;width:calc(100% - 4px);height:60%;background:var(--body)}
`;}
function makeHTML(d){
  const lines=d.lines.map(t=>`<div class="line">${t.replace(/</g,'&lt;')}</div>`).join('');
  return`<!DOCTYPE html><html><head><meta charset=utf-8>
  <style>:root{--body:${d.colors.body};--flap:${d.colors.flap};--paper:${d.colors.paper};--bg:${d.colors.bg};--body-border:#0000;--flap-border:#0000}
  ${viewerCSS()}</style></head><body>
  <div class=envelope>
    <div class=body></div>
    ${d.sticker?`<img src="${d.sticker}" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);height:200px;width:auto">`:''}
    <div class=mask></div><div class=flap></div>
    <div class=paper>${lines}</div>
  </div></body></html>`;
}
function refreshPreview(){preview.srcdoc=makeHTML(collect());}
refreshPreview();

/* ---------- generate link ---------- */
generate.onclick=()=>{
  const data=collect();
  if(!data.lines.length){alert('Add at least one message line.');return;}
  const payload=btoa(encodeURIComponent(JSON.stringify(data)));
  const url=`${location.origin}/ecard.html?d=${payload}`;
  linkField.value=url;
  linkWrap.style.display='block';
};
</script>
</body>
</html>
