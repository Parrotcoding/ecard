<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E‑Card Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #60A085;
      --secondary: #76C69C;
      --bg: #f0f0f0;
      --input-bg: #fff;
      --input-border: #ccc;
    }
    * { box-sizing:border-box; margin:0; padding:0; font-family:Poppins,sans-serif }
    body { background:var(--bg); padding:2rem; }
    h1 { margin-bottom:1rem; font-weight:700; }
    form { max-width:600px; display:grid; gap:1rem; }

    /* File & URL inputs */
    .sticker-group {
      display:flex; gap:1rem; align-items:center;
    }
    .sticker-group label {
      flex:1; display:flex; flex-direction:column; font-size:.9rem;
    }
    .sticker-group input[type="file"] {
      border:none; background:var(--input-bg);
    }
    .sticker-group input[type="text"] {
      padding:.6rem 1rem; border:1px solid var(--input-border);
      border-radius:9999px; background:var(--input-bg); width:100%;
    }

    /* lines + toolbar + other controls (same as before) */
    /* ... paste your existing styles for #toolbar, #lines, inputs, buttons ... */

    /* For brevity, assume you merge in all the previous styles here */
  </style>
</head>
<body>

  <h1>Create Your Seafoam Envelope E‑Card</h1>

  <div id="toolbar">
    <!-- your floating toolbar here -->
  </div>

  <form id="cardForm">
    <!-- Sticker upload or URL -->
    <div class="sticker-group">
      <label>
        Upload sticker<br>
        <input type="file" id="stickerFile" accept="image/*">
      </label>
      <label>
        or Sticker URL<br>
        <input type="text" id="stickerUrl" placeholder="https://…">
      </label>
    </div>

    <!-- Message lines, To/From, Generate button -->
    <!-- reuse your existing markup for lines, addLine, toField, fromField, generate -->
  </form>

  <div id="linkWrap">
    <input id="linkField" readonly>
    <button id="copyBtn">Copy</button>
  </div>

  <script>
  const CardBuilder = (() => {
    // DOM refs
    const fileInput   = document.getElementById('stickerFile');
    const urlInput    = document.getElementById('stickerUrl');
    let fileDataUrl   = '';

    // read file as data URL when selected
    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;
      if (file.size > 2*1024*1024) {
        alert('Max file size is 2 MB.');
        fileInput.value = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        fileDataUrl = reader.result;
      };
      reader.readAsDataURL(file);
    });

    // Collect, but prefer uploaded file over URL
    function collect() {
      const sticker = fileDataUrl || urlInput.value.trim();
      // rest of your collect logic (lines, to, from)
      const data = {
        sticker,
        to: document.getElementById('toField').value.trim(),
        from: document.getElementById('fromField').value.trim(),
        lines: Array.from(document.querySelectorAll('#lines input')).map(i=>({
          text: i.value.trim(),
          align: i.style.textAlign||'left',
          bold: i.style.fontWeight==='700',
          italic: i.style.fontStyle==='italic',
          underline: i.style.textDecoration.includes('underline')
        })).filter(l=>l.text)
      };
      return data;
    }

    function onGenerate() {
      const data = collect();
      if (!data.sticker) return alert('Please upload a sticker or enter a URL.');
      if (!data.lines.length) return alert('Add at least one line.');
      const payload = btoa(encodeURIComponent(JSON.stringify(data)));
      const url = `${location.origin}/ecard.html?d=${payload}`;
      document.getElementById('linkField').value = url;
      document.getElementById('linkWrap').style.display = 'flex';
    }

    function init() {
      // your existing init code: addLine seeds, toolbar wiring, generate click, copy click
      document.getElementById('generate').addEventListener('click', onGenerate);
    }

    return { init };
  })();

  document.addEventListener('DOMContentLoaded', CardBuilder.init);
  </script>
</body>
</html>
