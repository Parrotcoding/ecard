<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Eâ€‘Card</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* static CSS */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
    body{background:var(--bg,#f0f0f0);min-height:1800vh}
    .envelope{position:fixed;top:65%;left:50%;width:60vw;height:60vh;transform:translate(-50%,-50%);perspective:800px}
    .body{position:absolute;top:0;left:0;width:100%;height:100%;background:var(--body,#A8E6CF);border:2px solid var(--body-border,#82C9A1)}
    .flap{position:absolute;top:0;left:0;width:100%;height:50%;background:var(--flap,#76C69C);border:2px solid var(--flap-border,#60A085);clip-path:polygon(0 0,100% 0,50% 100%)}
    .mask{position:absolute;bottom:2px;left:2px;width:calc(100% - 4px);height:60%;background:var(--body,#A8E6CF)}
    .paper{position:absolute;bottom:2px;left:2px;width:calc(100% - 4px);height:0;background:var(--paper,#fff8e7);padding:2rem 1rem 2rem;transition:height .1s linear;z-index:2;text-align:center}
    .line{margin:1rem 0;font-size:1.25rem;}  /* vertically stacked lines */
  </style>
</head>
<body>

  <div class="envelope" id="env">
    <div class="body"></div>
    <img class="sticker" id="st" alt="Sticker">
    <div class="mask"></div>
    <div class="flap"></div>
    <div class="paper" id="paper"></div>
  </div>

<script>
(function(){
  /* decode ?d= */
  const dataStr=new URLSearchParams(location.search).get('d');
  if(!dataStr){document.body.innerHTML='<p style="padding:2rem">Missing card data.</p>';return;}
  let d;try{d=JSON.parse(decodeURIComponent(atob(dataStr)));}catch(e){document.body.innerHTML='<p style="padding:2rem">Invalid link.</p>';return;}

  /* apply colours */
  const shade=h=>{const n=parseInt(h.slice(1),16),a=-0.2*255;const r=Math.max(0,Math.min(255,(n>>16)+a)),g=Math.max(0,Math.min(255,((n>>8)&255)+a)),b=Math.max(0,Math.min(255,(n&255)+a));return"#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);}
  document.documentElement.style.setProperty('--body',d.colors.body);
  document.documentElement.style.setProperty('--flap',d.colors.flap);
  document.documentElement.style.setProperty('--paper',d.colors.paper);
  document.documentElement.style.setProperty('--bg',d.colors.bg);
  document.documentElement.style.setProperty('--body-border',shade(d.colors.body));
  document.documentElement.style.setProperty('--flap-border',shade(d.colors.flap));

  /* fill lines + sticker */
  const paper=document.getElementById('paper');
  d.lines.forEach(t=>{const div=document.createElement('div');div.className='line';div.textContent=t;paper.appendChild(div);});
  if(d.sticker)document.getElementById('st').src=d.sticker;else document.getElementById('st').remove();
})();
</script>
</body>
</html>
