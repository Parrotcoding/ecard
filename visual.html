<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seafoam E‑Card Visual Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lora:wght@400;700&family=Montserrat:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body { margin:0; padding:1rem; background:#f0f0f0; font-family:'Poppins',sans-serif; }
    h1 { text-align:center; margin-bottom:1rem }

    /* workspace */
    #workspace { display:flex; gap:1rem; }
    #paper {
      position:relative; flex:1;
      background:#fff8e7; border:2px solid #82C9A1;
      min-height:400px; resize:vertical; overflow:auto;
    }
    #assets { width:200px; background:#fafafa; border:2px solid #ddd; padding:.5rem; overflow:auto; }
    #assetList img { width:100%; margin-bottom:.5rem; cursor:grab; border:1px solid #ccc; border-radius:4px; }

    /* toolbars */
    #toolbar, #shapeMenu, #textToolbar, #shapeToolbar, #fontMenu { position:absolute; display:none; }
    #toolbar {
      background:rgba(255,255,255,0.95); border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1); z-index:1000;
    }
    #toolbar button { width:36px; height:36px; border:none; border-radius:50%; background:#A8E6CF; cursor:pointer; }
    #toolbar button:hover { background:#76C69C }
    #toolbar button img { width:20px; height:20px }

    #shapeMenu {
      background:rgba(255,255,255,0.95); border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1); z-index:1001;
    }
    #shapeMenu button { width:32px; height:32px; border:none; border-radius:4px; background:#A8E6CF; cursor:pointer; }
    #shapeMenu button:hover { background:#76C69C }
    #shapeMenu button img { width:20px; height:20px }

    #textToolbar {
      position:absolute; background:#fff; border:1px solid #ccc; border-radius:4px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:2000; white-space:nowrap;
    }
    #textToolbar button { background:transparent; border:none; cursor:pointer; }
    #textToolbar button img { width:20px; height:20px }
    #textToolbar input { width:3rem; border:1px solid #ccc; border-radius:4px; padding:2px; }

    #shapeToolbar {
      position:absolute; background:#fff; border:1px solid #ccc; border-radius:4px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:2001; white-space:nowrap;
    }
    #shapeToolbar input { margin:0 }

    #fontMenu {
      position:absolute; top:100%; left:0; display:none;
      max-height:200px; width:150px; overflow-y:auto;
      background:#fff; border:1px solid #ccc; border-radius:4px;
      box-shadow:0 2px 6px rgba(0,0,0,.1); z-index:3000;
    }
    #fontMenu .fontOption {
      display:block; width:100%; padding:6px 8px; text-align:left;
      background:transparent; border:none; cursor:pointer; font-size:.95rem;
    }
    #fontMenu .fontOption:hover { background:#f0f0f0 }

    /* handles */
    .resize-handle, .vertex-handle, .rotate-handle { display:none; }
    .resize-handle { position:absolute; width:10px; height:10px; background:#fff; border:1px solid #60A085; }
    .handle-nw { cursor:nwse-resize; top:-5px; left:-5px }
    .handle-ne { cursor:nesw-resize; top:-5px; right:-5px }
    .handle-sw { cursor:nesw-resize; bottom:-5px; left:-5px }
    .handle-se { cursor:nwse-resize; bottom:-5px; right:-5px }
    .vertex-handle {
      position:absolute; width:12px; height:12px; background:#fff;
      border:2px solid #60A085; border-radius:50%; cursor:move; margin:-6px;
    }
    .rotate-handle {
      position:absolute; top:-24px; left:50%; transform:translateX(-50%);
      width:12px; height:12px; background:#fff; border:2px solid #60A085;
      border-radius:50%; cursor:grab;
    }
    .element.selected .resize-handle,
    .element.selected .rotate-handle,
    .shape-wrapper.selected .vertex-handle { display:block !important }

    /* content */
    .element, .shape-wrapper { position:absolute; user-select:none; transform-origin:center; }
    .text-element {
      min-width:50px; min-height:20px; padding:.2rem;
      background:transparent; outline:none; cursor:text;
    }
    .shape-rect {
      width:100px; height:60px; background:rgba(96,160,133,0.3);
      border:2px solid #60A085;
    }
    .shape-circle {
      width:60px; height:60px; background:rgba(96,160,133,0.3);
      border:2px solid #60A085; border-radius:50%;
    }
    .shape-wrapper svg { display:block }
    .image-wrapper {
      width:100px; height:100px;
      background-size:contain; background-repeat:no-repeat; background-position:center;
    }
  </style>
</head>
<body>
  <h1>Visual E‑Card Editor</h1>
  <div id="workspace">
    <div id="paper"></div>
    <div id="assets"><h2>Assets</h2><div id="assetList"></div></div>
  </div>

  <div id="toolbar">
    <button id="btnText" title="Add Text">T</button>
    <button id="btnImage" title="Add Image"><img src="image.svg" alt=""></button>
    <button id="btnShape" title="Add Shape"><img src="shapes.svg" alt=""></button>
  </div>

  <div id="shapeMenu">
    <button data-shape="rect" title="Rectangle">◻</button>
    <button data-shape="circle" title="Circle">◯</button>
    <button data-shape="triangle" title="Triangle">△</button>
  </div>

  <div id="textToolbar">
    <button id="tbBold"><b>B</b></button>
    <button id="tbItalic"><i>I</i></button>
    <button id="tbUnderline"><u>U</u></button>
    <button id="tbAlignLeft"><img src="align-left.svg" alt=""></button>
    <button id="tbAlignCenter"><img src="align-center.svg" alt=""></button>
    <button id="tbAlignRight"><img src="align-right.svg" alt=""></button>
    <button id="tbFont">Aa</button>
    <input type="number" id="tbFontSize" min="8" max="72">px
    <input type="color"  id="tbColor">
    <div id="fontMenu">
      <button class="fontOption" data-font="Poppins"   style="font-family:'Poppins',sans-serif">Poppins</button>
      <button class="fontOption" data-font="Roboto"    style="font-family:'Roboto',sans-serif">Roboto</button>
      <button class="fontOption" data-font="Open Sans" style="font-family:'Open Sans',sans-serif">Open Sans</button>
      <button class="fontOption" data-font="Lora"      style="font-family:'Lora',serif">Lora</button>
      <button class="fontOption" data-font="Montserrat"style="font-family:'Montserrat',sans-serif">Montserrat</button>
    </div>
  </div>

  <div id="shapeToolbar">
    <input type="color" id="shapeFill">
    <input type="color" id="shapeStroke">
    <input type="number" id="shapeStrokeWidth" min="0" max="20">px
    <input type="range" id="shapeOpacity" min="0" max="1" step="0.05">
  </div>

  <script>
  ;(function(){
    const paper       = document.getElementById('paper'),
          toolbar     = document.getElementById('toolbar'),
          shapeMenu   = document.getElementById('shapeMenu'),
          textToolbar = document.getElementById('textToolbar'),
          shapeToolbar= document.getElementById('shapeToolbar'),
          assetList   = document.getElementById('assetList'),
          tbFont      = document.getElementById('tbFont'),
          fontMenu    = document.getElementById('fontMenu'),
          fontOpts    = fontMenu.querySelectorAll('.fontOption'),
          shapeFill   = document.getElementById('shapeFill'),
          shapeStroke = document.getElementById('shapeStroke'),
          shapeStW    = document.getElementById('shapeStrokeWidth'),
          shapeOp     = document.getElementById('shapeOpacity');
    let clickX=0, clickY=0, selectedEl=null, selectedPoly=null;

    /* Utility and helper functions (rgbToHex, updateTextToolbarPosition,
       updateShapeToolbarPosition, deselect, select, initElement,
       addAsset, insertBasic, insertTriangle, makeDraggable,
       enableDrop, addResizeHandles, startResize, addRotateHandle,
       makeTriangleResizable) are exactly as in the previous full code. */

    // ----- Show insert toolbar on blank paper -----
    paper.addEventListener('mousedown', e => {
      if (
        e.target.closest('#toolbar, #shapeMenu, #textToolbar, #shapeToolbar, #fontMenu') ||
        e.target !== paper
      ) return;
      deselect();
      clickX = e.offsetX;
      clickY = e.offsetY;
      const tb = toolbar.getBoundingClientRect();
      toolbar.style.left    = `${e.pageX - tb.width/2}px`;
      toolbar.style.top     = `${e.pageY - tb.height - 12}px`;
      toolbar.style.display = 'flex';
      shapeMenu.style.display    = 'none';
      textToolbar.style.display  = 'none';
      shapeToolbar.style.display = 'none';
      fontMenu.style.display     = 'none';
      e.stopPropagation();
    });

    // ----- Hide on click anywhere except paper or toolbars -----
    [toolbar, shapeMenu, textToolbar, shapeToolbar, fontMenu].forEach(el=>
      el.addEventListener('click', e=>e.stopPropagation())
    );
    document.addEventListener('click', e => {
      // don't hide if clicking paper (so initial click won't immediately hide)
      if (e.target === paper) return;
      // don't hide if clicking inside any toolbar
      if (e.target.closest('#toolbar, #shapeMenu, #textToolbar, #shapeToolbar, #fontMenu'))
        return;
      toolbar.style.display    = 'none';
      shapeMenu.style.display  = 'none';
      textToolbar.style.display= 'none';
      shapeToolbar.style.display='none';
      fontMenu.style.display   = 'none';
    });

    // Remaining event wiring for insert actions, text toolbar,
    // font menu, shape toolbar, etc. — unchanged from previous code.
    // ...

  })();
  </script>
</body>
</html>
