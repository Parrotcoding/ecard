<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seafoam¬†E‚ÄëCard Visual Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; padding:1rem; background:#f0f0f0; font-family:'Poppins',sans-serif; }
    h1 { text-align:center; margin-bottom:1rem }

    /* workspace */
    #workspace { display:flex; gap:1rem; }
    #paper {
      position:relative; flex:1;
      background:#fff8e7; border:2px solid #82C9A1;
      min-height:400px; resize:vertical; overflow:auto;
    }
    #assets {
      width:200px; background:#fafafa; border:2px solid #ddd;
      padding:.5rem; overflow:auto;
    }
    #assetList img {
      width:100%; margin-bottom:.5rem; cursor:grab;
      border:1px solid #ccc; border-radius:4px;
    }

    /* main toolbar */
    #toolbar {
      position:absolute; display:none;
      background:rgba(255,255,255,0.95); border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:1000;
    }

    /* shape menu */
    #shapeMenu {
      position:absolute; display:none;
      background:rgba(255,255,255,0.95); border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:1001;
    }

    /* text toolbar */
    #textToolbar {
      position:absolute; display:none;
      background:#fff; border:1px solid #ccc; border-radius:4px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:2000;
      /* ensure it expands to fit all buttons */
      flex-wrap: nowrap;
      white-space: nowrap;
      width: max-content;
    }
    #textToolbar button {
      border:none; background:transparent; cursor:pointer; font-size:1rem;
    }
    #textToolbar select,
    #textToolbar input[type="color"],
    #textToolbar input[type="number"] {
      width:3rem; border:1px solid #ccc; border-radius:4px; padding:2px;
    }

    /* handles */
    .resize-handle, .vertex-handle, .rotate-handle { display:none; }
    .resize-handle {
      position:absolute; width:10px; height:10px;
      background:#fff; border:1px solid #60A085; z-index:10;
    }
    .handle-nw { cursor:nwse-resize; top:-5px; left:-5px; }
    .handle-ne { cursor:nesw-resize; top:-5px; right:-5px; }
    .handle-sw { cursor:nesw-resize; bottom:-5px; left:-5px; }
    .handle-se { cursor:nwse-resize; bottom:-5px; right:-5px; }

    .vertex-handle {
      position:absolute; width:12px; height:12px;
      background:#fff; border:2px solid #60A085; border-radius:50%;
      z-index:10; cursor:move; margin:-6px 0 0 -6px;
    }

    .rotate-handle {
      position:absolute; top:-20px; left:50%; transform:translateX(-50%);
      width:12px; height:12px; background:#fff;
      border:2px solid #60A085; border-radius:50%; cursor:grab; z-index:11;
    }

    .element.selected .resize-handle,
    .shape-wrapper.selected .vertex-handle,
    .element.selected .rotate-handle {
      display:block !important;
    }

    /* element styles */
    .element, .shape-wrapper { position:absolute; user-select:none; transform-origin:center; }
    .text-element {
      min-width:50px; min-height:20px; padding:.2rem;
      background:transparent; outline:none; cursor:text;
    }
    .shape-rect {
      width:100px; height:60px;
      background:rgba(96,160,133,0.3); border:2px solid #60A085;
    }
    .shape-circle {
      width:60px; height:60px;
      background:rgba(96,160,133,0.3); border:2px solid #60A085;
      border-radius:50%;
    }
    .image-wrapper {
      width:100px; height:100px;
      background-size:contain; background-repeat:no-repeat; background-position:center;
    }
    .shape-wrapper { background-color:transparent; }
  </style>
</head>
<body>
  <h1>Visual¬†E‚ÄëCard¬†Editor</h1>
  <div id="workspace">
    <div id="paper"></div>
    <div id="assets">
      <h2>Assets</h2>
      <div id="assetList"></div>
    </div>
  </div>

  <!-- Main toolbar -->
  <div id="toolbar">
    <button id="btnText"  title="Add Text">T</button>
    <button id="btnImage" title="Add Image">üñºÔ∏è</button>
    <button id="btnShape" title="Add Shape">‚¨ú</button>
  </div>

  <!-- Shape menu -->
  <div id="shapeMenu">
    <button data-shape="rect"     title="Rectangle">‚óª</button>
    <button data-shape="circle"   title="Circle">‚óØ</button>
    <button data-shape="triangle" title="Triangle">‚ñ≥</button>
  </div>

  <!-- Text toolbar -->
  <div id="textToolbar">
    <button id="tbBold"><b>B</b></button>
    <button id="tbItalic"><i>I</i></button>
    <button id="tbUnderline"><u>U</u></button>
    <button id="tbAlignLeft">‚â°</button>
    <button id="tbAlignCenter">‚â£</button>
    <button id="tbAlignRight">‚â°</button>
    <input type="number" id="tbFontSize" min="8" max="72" title="Font Size">px
    <input type="color"  id="tbColor"      title="Text Color">
  </div>

  <script>
  (function(){
    const paper       = document.getElementById('paper');
    const toolbar     = document.getElementById('toolbar');
    const shapeMenu   = document.getElementById('shapeMenu');
    const textToolbar = document.getElementById('textToolbar');
    const assetList   = document.getElementById('assetList');
    let clickX=0, clickY=0, selectedEl=null;

    function rgbToHex(rgb) {
      const [r,g,b] = rgb.match(/\d+/g).map(Number);
      return '#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);
    }

    function deselect() {
      if (!selectedEl) return;
      selectedEl.classList.remove('selected');
      selectedEl = null;
      textToolbar.style.display = 'none';
    }

    function select(el) {
      if (selectedEl === el) return;
      deselect();
      selectedEl = el;
      el.classList.add('selected');
      if (el.classList.contains('text-element')) {
        // position textToolbar above/below the element
        const rect   = el.getBoundingClientRect();
        const tbRect = textToolbar.getBoundingClientRect();
        let left = rect.left;
        let top  = rect.top - tbRect.height - 8;
        if (top < 8) top = rect.bottom + 8;
        textToolbar.style.left  = `${left}px`;
        textToolbar.style.top   = `${top}px`;
        textToolbar.style.display = 'flex';
        // init controls
        document.getElementById('tbFontSize').value = parseInt(getComputedStyle(el).fontSize);
        document.getElementById('tbColor').value    = rgbToHex(getComputedStyle(el).color);
      }
    }

    // Show main toolbar
    paper.addEventListener('click', e=>{
      if (e.target === paper) deselect();
      clickX = e.offsetX; clickY = e.offsetY;
      const tb = toolbar.getBoundingClientRect();
      toolbar.style.left  = `${e.pageX - tb.width/2}px`;
      toolbar.style.top   = `${e.pageY - tb.height - 12}px`;
      toolbar.style.display = 'flex';
      shapeMenu.style.display = 'none';
      e.stopPropagation();
    });
    [toolbar, shapeMenu, textToolbar].forEach(el=>el.addEventListener('click', e=>e.stopPropagation()));
    document.addEventListener('click', ()=>{ toolbar.style.display='none'; shapeMenu.style.display='none'; });

    // Add Text
    document.getElementById('btnText').addEventListener('click', e=>{
      e.stopPropagation();
      const txt = document.createElement('div');
      txt.className = 'element text-element';
      txt.contentEditable = true;
      txt.style.left = `${clickX}px`;
      txt.style.top  = `${clickY}px`;
      txt.textContent = 'Enter text';
      paper.append(txt);
      initElement(txt,false);
      toolbar.style.display='none';
      txt.focus();
    });

    // Add Image
    document.getElementById('btnImage').addEventListener('click', e=>{
      e.stopPropagation();
      const url = prompt('Enter image URL:');
      if (!url) return;
      addAsset(url);
      const wrap = document.createElement('div');
      wrap.className = 'element image-wrapper';
      wrap.style.left = `${clickX}px`;
      wrap.style.top  = `${clickY}px`;
      wrap.style.backgroundImage = `url(${url})`;
      paper.append(wrap);
      initElement(wrap,false);
      toolbar.style.display='none';
    });

    // Shape menu
    document.getElementById('btnShape').addEventListener('click', e=>{
      e.stopPropagation();
      const r = e.currentTarget.getBoundingClientRect();
      shapeMenu.style.left  = `${r.right + 8}px`;
      shapeMenu.style.top   = `${r.top}px`;
      shapeMenu.style.display = 'flex';
    });
    shapeMenu.addEventListener('click', e=>{
      const btn = e.target.closest('[data-shape]');
      if (!btn) return;
      const type = btn.dataset.shape;
      if (type === 'triangle') insertTriangle();
      else insertBasic(type);
      shapeMenu.style.display='none';
      toolbar.style.display='none';
    });

    // Text toolbar actions
    document.getElementById('tbBold').onclick = ()=>{
      if (!selectedEl) return;
      selectedEl.style.fontWeight = selectedEl.style.fontWeight==='bold'?'':'bold';
    };
    document.getElementById('tbItalic').onclick = ()=>{
      if (!selectedEl) return;
      selectedEl.style.fontStyle = selectedEl.style.fontStyle==='italic'?'':'italic';
    };
    document.getElementById('tbUnderline').onclick = ()=>{
      if (!selectedEl) return;
      selectedEl.style.textDecoration = selectedEl.style.textDecoration==='underline'?'':'underline';
    };
    document.getElementById('tbAlignLeft').onclick = ()=> selectedEl && (selectedEl.style.textAlign='left');
    document.getElementById('tbAlignCenter').onclick = ()=> selectedEl && (selectedEl.style.textAlign='center');
    document.getElementById('tbAlignRight').onclick = ()=> selectedEl && (selectedEl.style.textAlign='right');
    document.getElementById('tbFontSize').oninput = e=>{
      if (selectedEl) selectedEl.style.fontSize = e.target.value + 'px';
    };
    document.getElementById('tbColor').oninput = e=>{
      if (selectedEl) selectedEl.style.color = e.target.value;
    };

    function addAsset(src){
      const thumb = document.createElement('img');
      thumb.src = src; thumb.draggable = true;
      thumb.addEventListener('dragstart', ev=> ev.dataTransfer.setData('text/plain', src) );
      assetList.append(thumb);
    }

    function insertBasic(type){
      const el = document.createElement('div');
      el.className = 'element ' + (type==='rect'?'shape-rect':'shape-circle');
      el.style.left = `${clickX}px`;
      el.style.top  = `${clickY}px`;
      paper.append(el);
      initElement(el,false);
    }

    function insertTriangle(){
      const wrap = document.createElement('div');
      wrap.className = 'shape-wrapper';
      wrap.style.left   = `${clickX}px`;
      wrap.style.top    = `${clickY}px`;
      wrap.style.width  = '80px';
      wrap.style.height = '70px';
      const svgNS = "http://www.w3.org/2000/svg";
      const svg   = document.createElementNS(svgNS,'svg');
      svg.setAttribute('width','100%');
      svg.setAttribute('height','100%');
      const poly = document.createElementNS(svgNS,'polygon');
      poly.setAttribute('points','0,70 40,0 80,70');
      poly.setAttribute('fill','rgba(96,160,133,0.3)');
      poly.setAttribute('stroke','#60A085');
      poly.setAttribute('stroke-width','2');
      svg.append(poly);
      wrap.append(svg);
      paper.append(wrap);
      initElement(wrap,true,poly);
    }

    function initElement(el,isTri,poly){
      makeDraggable(el);
      enableDrop(el);
      addResizeHandles(el);
      addRotateHandle(el);
      if(isTri) makeTriangleResizable(el,poly);
      el.addEventListener('mousedown', e=>{
        e.stopPropagation(); select(el);
      });
    }

    // ... include the implementations of makeDraggable, enableDrop, addResizeHandles, startResize,
    // addRotateHandle, makeTriangleResizable here, exactly as before ...

  })();
  </script>
</body>
</html>
