<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SeafoamÂ Eâ€‘Card Visual Editor with Watercolor Templates</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lora:wght@400;700&family=Montserrat:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body { margin:0; padding:1rem; background:#f0f0f0; font-family:'Poppins',sans-serif }
    h1 { text-align:center; margin-bottom:1rem }
    #workspace { display:flex; gap:1rem }
    #paper {
      position:relative; flex:1;
      background:#fff8e7; border:2px solid #82C9A1;
      min-height:400px; resize:vertical; overflow:auto;
    }
    /* â€”â€” assets panel & tabs â€”â€” */
    #assets { width:300px; background:#fafafa; border:2px solid #ddd; display:flex; flex-direction:column }
    #assetTabs { display:flex }
    #assetTabs button {
      flex:1; padding:.5rem; border:none; cursor:pointer;
      background:#ddd; font-weight:600;
    }
    #assetTabs button.active { background:#fff; border-bottom:2px solid #fff }
    .assetPanel { flex:1; overflow:auto; padding:.5rem; display:none }
    .assetPanel.active { display:block }

    /* â€”â€” templates panel â€”â€” */
    #assetsTemplates .templateItem {
      margin-bottom:1rem; cursor:pointer;
      border:1px solid #ccc; border-radius:6px;
      overflow:hidden; text-align:center;
    }
    #assetsTemplates .templateItem .preview {
      position:relative; width:100%; height:100px;
      background:#fff8e7; border-bottom:1px solid #ccc;
    }
    #assetsTemplates .templateItem span {
      display:block; padding:.5rem; background:#f9f9f9;
      font-weight:600;
    }

    /* â€”â€” images panel â€”â€” */
    #assetsImages input { width:100%; margin-bottom:.5rem; padding:.25rem }
    #assetsImages button {
      width:100%; margin-bottom:1rem; padding:.5rem;
      background:#60A085; border:none; color:#fff; cursor:pointer;
      border-radius:4px;
    }
    #assetList img {
      width:100%; margin-bottom:.5rem; cursor:grab;
      border:1px solid #ccc; border-radius:4px;
    }

    /* â€”â€” emojis panel â€”â€” */
    #assetEmojis .emojiItem {
      font-size:1.5rem; display:inline-block;
      padding:.25rem; margin:.25rem; cursor:grab;
    }

    /* â€”â€” toolbars & handles â€”â€” */
    #toolbar,#shapeMenu,#textToolbar,#shapeToolbar,#fontMenu {
      position:absolute; display:none; z-index:2000;
      background:#fff; border:1px solid #ccc; border-radius:4px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    #toolbar { padding:.25rem; display:flex; gap:.5rem }
    #toolbar button {
      width:36px; height:36px; border:none; border-radius:50%;
      background:#A8E6CF; cursor:pointer;
    }
    #toolbar button:hover { background:#76C69C }
    #toolbar button img { width:20px; height:20px }

    #shapeMenu { padding:.25rem; display:flex; gap:.5rem; border-radius:8px }
    #shapeMenu button {
      width:32px; height:32px; border:none; border-radius:4px;
      background:#A8E6CF; cursor:pointer;
    }
    #shapeMenu button:hover { background:#76C69C }

    #textToolbar,#shapeToolbar {
      padding:.25rem; display:flex; align-items:center; gap:.5rem; white-space:nowrap;
    }
    #textToolbar button,#shapeToolbar button {
      background:transparent; border:none; cursor:pointer; font-size:1.1rem;
    }
    #textToolbar button img,#shapeToolbar button img {
      width:20px; height:20px;
    }
    #textToolbar input,#shapeToolbar input {
      border:1px solid #ccc; border-radius:4px; padding:2px;
    }
    #shapeToolbar input[type=number] { width:3rem }
    #shapeToolbar input[type=range]  { width:5rem }

    .tb-delete {
      font-size:1.2rem; color:#c0392b; padding:0 6px; cursor:pointer;
    }
    .tb-delete:hover { color:#e74c3c }

    #fontMenu {
      position:absolute; top:100%; left:0;
      max-height:200px; width:150px; overflow-y:auto;
    }
    #fontMenu .fontOption {
      display:block; width:100%; padding:6px 8px; text-align:left;
      background:transparent; border:none; cursor:pointer; font-size:.95rem;
    }
    #fontMenu .fontOption:hover { background:#f0f0f0 }

    .resize-handle,.vertex-handle,.rotate-handle { display:none }
    .resize-handle {
      position:absolute; width:10px; height:10px;
      background:#fff; border:1px solid #60A085;
    }
    .handle-nw { cursor:nwse-resize; top:-5px; left:-5px }
    .handle-ne { cursor:nesw-resize; top:-5px; right:-5px }
    .handle-sw { cursor:nesw-resize; bottom:-5px; left:-5px }
    .handle-se { cursor:nwse-resize; bottom:-5px; right:-5px }
    .vertex-handle {
      position:absolute; width:12px; height:12px;
      background:#fff; border:2px solid #60A085;
      border-radius:50%; cursor:move; margin:-6px;
    }
    .rotate-handle {
      position:absolute; top:-20px; left:50%;
      transform:translateX(-50%); width:12px; height:12px;
      background:#fff; border:2px solid #60A085;
      border-radius:50%; cursor:grab;
    }
    .element.selected .resize-handle,
    .element.selected .rotate-handle,
    .shape-wrapper.selected .vertex-handle {
      display:block !important;
    }

    /* content */
    .element,.shape-wrapper { position:absolute; user-select:none; transform-origin:center }
    .text-wrapper { position:relative }
    .text-content {
      position:absolute; top:0; left:0; right:0; bottom:0;
      padding-top:20px; overflow:auto; outline:none; cursor:text;
    }
    .shape-rect {
      width:100px; height:60px; background:#60A085;
      border:2px solid #60A085;
    }
    .shape-circle {
      width:60px; height:60px; background:#60A085;
      border:2px solid #60A085; border-radius:50%;
    }
    .shape-wrapper svg { display:block; }
  </style>
</head>
<body>
  <h1>VisualÂ Eâ€‘CardÂ Editor</h1>
  <div id="workspace">
    <div id="paper"></div>
    <div id="assets">
      <div id="assetTabs">
        <button id="tabTemplates" class="active">Templates</button>
        <button id="tabImages">Images</button>
        <button id="tabEmojis">Emojis</button>
      </div>

      <!-- TEMPLATES -->
      <div id="assetsTemplates" class="assetPanel active">
        <div class="templateItem" data-template="birthday">
          <div class="preview">
            <svg viewBox="0 0 100 60" style="width:100%;height:100%">
              <defs>
                <radialGradient id="wc1">
                  <stop offset="0%" stop-color="#FDD835" stop-opacity="0.6"/>
                  <stop offset="100%" stop-color="#FDD835" stop-opacity="0"/>
                </radialGradient>
                <filter id="grain">
                  <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" result="noise"/>
                  <feColorMatrix type="saturate" values="0" in="noise" result="monoNoise"/>
                  <feBlend in="SourceGraphic" in2="monoNoise" mode="multiply"/>
                </filter>
              </defs>
              <ellipse cx="50" cy="40" rx="40" ry="20"
                       fill="url(#wc1)" filter="url(#grain)"/>
              <rect x="20" y="10" width="60" height="30"
                    fill="#F9A825" stroke="#F57F17" stroke-width="2"
                    rx="5"/>
            </svg>
          </div>
          <span>Birthday ğŸ‰</span>
        </div>
        <div class="templateItem" data-template="thankyou">
          <div class="preview">
            <svg viewBox="0 0 100 60" style="width:100%;height:100%">
              <defs>
                <radialGradient id="wc2">
                  <stop offset="0%" stop-color="#FFE0B2" stop-opacity="0.6"/>
                  <stop offset="100%" stop-color="#FFE0B2" stop-opacity="0"/>
                </radialGradient>
                <filter id="grain2">
                  <feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="2" result="noise"/>
                  <feColorMatrix type="saturate" values="0" in="noise" result="monoNoise"/>
                  <feBlend in="SourceGraphic" in2="monoNoise" mode="multiply"/>
                </filter>
              </defs>
              <path d="M0,20 L100,20 L100,40 L0,40 Z"
                    fill="url(#wc2)" filter="url(#grain2)"/>
              <text x="50" y="35" text-anchor="middle"
                    font-family="Poppins" font-size="14" fill="#BF360C">
                ThankÂ You!
              </text>
            </svg>
          </div>
          <span>ThankÂ You ğŸ™</span>
        </div>
      </div>

      <!-- IMAGES -->
      <div id="assetsImages" class="assetPanel">
        <input type="text" id="assetUrlInput" placeholder="ImageÂ URL" />
        <button id="assetAddBtn">AddÂ Image</button>
        <div id="assetList"></div>
      </div>

      <!-- EMOJIS -->
      <div id="assetEmojis" class="assetPanel">
        <div class="emojiItem">ğŸ‰</div>
        <div class="emojiItem">ğŸ‚</div>
        <div class="emojiItem">â¤ï¸</div>
        <div class="emojiItem">ğŸ˜Š</div>
        <div class="emojiItem">ğŸ</div>
        <div class="emojiItem">ğŸŒŸ</div>
        <div class="emojiItem">ğŸ¥³</div>
        <div class="emojiItem">ğŸ’Œ</div>
        <div class="emojiItem">ğŸˆ</div>
        <div class="emojiItem">âœ¨</div>
      </div>
    </div>
  </div>

  <!-- TOOLBARS -->
  <div id="toolbar">
    <button id="btnText" title="Add Text">T</button>
    <button id="btnShape" title="Add Shape"><img src="shapes.svg" alt="Shapes" /></button>
  </div>
  <div id="shapeMenu">
    <button data-shape="rect">â—»</button>
    <button data-shape="circle">â—¯</button>
    <button data-shape="triangle">â–³</button>
  </div>
  <div id="textToolbar">
    <button id="tbBold"><b>B</b></button>
    <button id="tbItalic"><i>I</i></button>
    <button id="tbUnderline"><u>U</u></button>
    <button id="tbAlignLeft"><img src="align-left.svg" /></button>
    <button id="tbAlignCenter"><img src="align-center.svg" /></button>
    <button id="tbAlignRight"><img src="align-right.svg" /></button>
    <button id="tbFont">Aa</button>
    <input type="number" id="tbFontSize" min="8" max="72" />px
    <input type="color" id="tbColor" />
    <button id="tbDeleteText" class="tb-delete">Ã—</button>
    <div id="fontMenu">
      <button class="fontOption" data-font="Poppins" style="font-family:'Poppins',sans-serif">Poppins</button>
      <button class="fontOption" data-font="Roboto"   style="font-family:'Roboto',sans-serif">Roboto</button>
      <button class="fontOption" data-font="OpenÂ Sans"style="font-family:'OpenÂ Sans',sans-serif">OpenÂ Sans</button>
      <button class="fontOption" data-font="Lora"     style="font-family:'Lora',serif">Lora</button>
      <button class="fontOption" data-font="Montserrat"style="font-family:'Montserrat',sans-serif">Montserrat</button>
    </div>
  </div>
  <div id="shapeToolbar">
    <input type="color" id="shapeFill" />
    <input type="color" id="shapeStroke" />
    <input type="number" id="shapeStrokeWidth" min="0" max="20" />px
    <input type="range" id="shapeOpacity" min="0" max="1" step="0.05" />
    <button id="tbDeleteShape" class="tb-delete">Ã—</button>
  </div>

  <script>
  ;(function(){
    // DOM refs
    const paper         = document.getElementById('paper'),
          tabTemplates  = document.getElementById('tabTemplates'),
          tabImages     = document.getElementById('tabImages'),
          tabEmojis     = document.getElementById('tabEmojis'),
          panelTemplates= document.getElementById('assetsTemplates'),
          panelImages   = document.getElementById('assetsImages'),
          panelEmojis   = document.getElementById('assetEmojis'),
          templateItems = document.querySelectorAll('.templateItem'),
          assetUrlIn    = document.getElementById('assetUrlInput'),
          assetAddBtn   = document.getElementById('assetAddBtn'),
          assetList     = document.getElementById('assetList'),
          emojiItems    = document.querySelectorAll('.emojiItem'),
          toolbar       = document.getElementById('toolbar'),
          shapeMenu     = document.getElementById('shapeMenu'),
          textToolbar   = document.getElementById('textToolbar'),
          shapeToolbar  = document.getElementById('shapeToolbar'),
          fontMenu      = document.getElementById('fontMenu'),
          fontOpts      = fontMenu.querySelectorAll('.fontOption'),
          shapeFill     = document.getElementById('shapeFill'),
          shapeStroke   = document.getElementById('shapeStroke'),
          shapeStW      = document.getElementById('shapeStrokeWidth'),
          shapeOp       = document.getElementById('shapeOpacity'),
          tbDeleteText  = document.getElementById('tbDeleteText'),
          tbDeleteShape = document.getElementById('tbDeleteShape');
    let clickX=0, clickY=0, selectedWrapper=null, selectedContent=null, selectedPoly=null;

    // TAB SWITCHING
    function clearTabs(){
      [tabTemplates,tabImages,tabEmojis].forEach(b=>b.classList.remove('active'));
      [panelTemplates,panelImages,panelEmojis].forEach(p=>p.classList.remove('active'));
    }
    tabTemplates.addEventListener('click',()=>{
      clearTabs();
      tabTemplates.classList.add('active');
      panelTemplates.classList.add('active');
    });
    tabImages.addEventListener('click',()=>{
      clearTabs();
      tabImages.classList.add('active');
      panelImages.classList.add('active');
    });
    tabEmojis.addEventListener('click',()=>{
      clearTabs();
      tabEmojis.classList.add('active');
      panelEmojis.classList.add('active');
    });

    // TEMPLATES DATA
    const templates = {
      birthday: [
        { type:'svg',
          svg:`<svg viewBox="0 0 100 60">
                 <defs>
                   <radialGradient id="wc1"><stop offset="0%" stop-color="#FDD835" stop-opacity="0.6"/><stop offset="100%" stop-color="#FDD835" stop-opacity="0"/></radialGradient>
                   <filter id="grain"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" result="noise"/><feColorMatrix type="saturate" values="0" in="noise" result="monoNoise"/><feBlend in="SourceGraphic" in2="monoNoise" mode="multiply"/></filter>
                 </defs>
                 <ellipse cx="50" cy="40" rx="40" ry="20" fill="url(#wc1)" filter="url(#grain)"/>
                 <rect x="20" y="10" width="60" height="30" fill="#F9A825" stroke="#F57F17" stroke-width="2" rx="5"/>
               </svg>`,
          left:50, top:30, width:150, height:80
        },
        { type:'text', text:'HappyÂ Birthday!', left:80, top:130, width:200, height:40,
          fontSize:24, color:'#155f46', align:'center' },
        { type:'shape', shape:'circle', left:20, top:200, width:80, height:80,
          fill:'#A8E6CF', stroke:'#82C9A1', strokeWidth:2, opacity:1 }
      ],
      thankyou: [
        { type:'svg',
          svg:`<svg viewBox="0 0 100 60">
                 <defs>
                   <radialGradient id="wc2"><stop offset="0%" stop-color="#FFE0B2" stop-opacity="0.6"/><stop offset="100%" stop-color="#FFE0B2" stop-opacity="0"/></radialGradient>
                   <filter id="grain2"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="2" result="noise"/><feColorMatrix type="saturate" values="0" in="noise" result="monoNoise"/><feBlend in="SourceGraphic" in2="monoNoise" mode="multiply"/></filter>
                 </defs>
                 <path d="M0,20 L100,20 L100,40 L0,40 Z" fill="url(#wc2)" filter="url(#grain2)"/>
                 <text x="50" y="35" text-anchor="middle" font-family="Poppins" font-size="14" fill="#BF360C">ThankÂ You!</text>
               </svg>`,
          left:30, top:30, width:180, height:80
        },
        { type:'text', text:'ThankÂ You!', left:50, top:120, width:180, height:40,
          fontSize:28, color:'#BF360C', align:'center' },
        { type:'svg',
          svg:`<svg viewBox="0 0 60 60">
                 <path d="M30 50 L10 30 A10,10 0 0,1 30,10 A10,10 0 0,1 50,30 Z" fill="#E91E63"/>
               </svg>`,
          left:160, top:180, width:60, height:60
        }
      ]
    };

    // APPLY TEMPLATE
    function applyTemplate(name){
      paper.innerHTML='';
      (templates[name]||[]).forEach(item=>{
        if(item.type==='svg'){
          const wrap=document.createElement('div');
          wrap.className='element';
          Object.assign(wrap.style,{
            left:item.left+'px', top:item.top+'px',
            width:item.width+'px', height:item.height+'px'
          });
          wrap.innerHTML=item.svg;
          paper.append(wrap);
          initElement(wrap,false,null);
        }
        else if(item.type==='text'){
          const wrap=document.createElement('div');
          wrap.className='element text-wrapper';
          Object.assign(wrap.style,{
            left:item.left+'px', top:item.top+'px',
            width:item.width+'px', height:item.height+'px'
          });
          const txt=document.createElement('div');
          txt.className='text-content';
          txt.contentEditable=true;
          txt.innerText=item.text;
          Object.assign(txt.style,{
            fontSize:item.fontSize+'px',
            color:item.color,
            textAlign:item.align
          });
          wrap.append(txt);
          paper.append(wrap);
          initElement(wrap,false,null);
        }
        else if(item.type==='shape'){
          if(item.shape==='triangle'){
            const wrap=document.createElement('div');
            wrap.className='shape-wrapper';
            Object.assign(wrap.style,{
              left:item.left+'px', top:item.top+'px',
              width:item.width+'px', height:item.height+'px'
            });
            const ns="http://www.w3.org/2000/svg",
                  svg=document.createElementNS(ns,'svg'),
                  poly=document.createElementNS(ns,'polygon');
            svg.setAttribute('width','100%'); svg.setAttribute('height','100%');
            poly.setAttribute('points',`0,${item.height} ${item.width/2},0 ${item.width},${item.height}`);
            poly.setAttribute('fill',item.fill);
            poly.setAttribute('stroke',item.stroke);
            poly.setAttribute('stroke-width',item.strokeWidth);
            poly.setAttribute('opacity',item.opacity);
            svg.append(poly); wrap.append(svg);
            paper.append(wrap);
            initElement(wrap,true,poly);
          } else {
            const wrap=document.createElement('div');
            wrap.className='element '+(item.shape==='rect'?'shape-rect':'shape-circle');
            Object.assign(wrap.style,{
              left:item.left+'px', top:item.top+'px',
              width:item.width+'px', height:item.height+'px',
              backgroundColor:item.fill,
              borderColor:item.stroke,
              borderWidth:item.strokeWidth+'px',
              opacity:item.opacity
            });
            paper.append(wrap);
            initElement(wrap,false,null);
          }
        }
      });
    }

    templateItems.forEach(el=>{
      el.addEventListener('click',()=>applyTemplate(el.dataset.template));
    });

    // IMAGE ASSETS
    assetAddBtn.addEventListener('click',()=>{
      const url=assetUrlIn.value.trim(); if(!url) return;
      const img=document.createElement('img');
      img.src=url; img.draggable=true;
      img.addEventListener('dragstart',ev=>ev.dataTransfer.setData('text/plain',url));
      assetList.append(img);
      assetUrlIn.value='';
    });

    // EMOJI DRAG
    emojiItems.forEach(em=>{
      em.draggable=true;
      em.addEventListener('dragstart',ev=>ev.dataTransfer.setData('text/plain',em.textContent));
    });

    // â€” ALL HELPER FUNCTIONS (drag, resize, rotate, toolbars, etc.) â€”
    // ... exactly as in your last full code, unchanged ...
    // (rgbToHex, updateTextToolbarPosition, updateShapeToolbarPosition,
    //  deselect/select, initElement, makeDraggable, enableDrop,
    //  addResizeHandles with emoji font scaling, addRotateHandle,
    //  makeTriangleResizable, insert toolbar logic, textToolbar actions,
    //  shapeToolbar actions, delete-handling.)

    // TEXT TOOLBAR ACTIONS (fixed arrow syntax!)
    document.getElementById('tbBold').onclick      =()=> selectedContent&&(selectedContent.style.fontWeight  = selectedContent.style.fontWeight==='bold'?'':'bold');
    document.getElementById('tbItalic').onclick    =()=> selectedContent&&(selectedContent.style.fontStyle   = selectedContent.style.fontStyle==='italic'?'':'italic');
    document.getElementById('tbUnderline').onclick =()=> selectedContent&&(selectedContent.style.textDecoration = selectedContent.style.textDecoration==='underline'?'':'underline');
    document.getElementById('tbAlignLeft').onclick   =()=> selectedContent&&(selectedContent.style.textAlign='left');
    document.getElementById('tbAlignCenter').onclick =()=> selectedContent&&(selectedContent.style.textAlign='center');
    document.getElementById('tbAlignRight').onclick  =()=> selectedContent&&(selectedContent.style.textAlign='right');
    document.getElementById('tbFontSize').addEventListener('input',e=> selectedContent&&(selectedContent.style.fontSize=e.target.value+'px'));
    document.getElementById('tbColor').addEventListener('input',e=> selectedContent&&(selectedContent.style.color=e.target.value));
    tbDeleteText.addEventListener('click',()=>{ if(selectedWrapper){ selectedWrapper.remove(); deselect(); } });

    // â€¦ rest of your code â€¦
  })();
  </script>
</body>
</html>
