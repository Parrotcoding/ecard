<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seafoam E‑Card Visual Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- import all your fonts at once -->
  <link href="https://fonts.googleapis.com/css2?
    family=Poppins:wght@400;700&
    family=Roboto:wght@400;700&
    family=Open+Sans:wght@400;700&
    family=Lora:wght@400;700&
    family=Montserrat:wght@400;700&display=swap"
    rel="stylesheet">
  <style>
    body { margin:0; padding:1rem; background:#f0f0f0; font-family:'Poppins',sans-serif; }
    h1 { text-align:center; margin-bottom:1rem }

    #workspace { display:flex; gap:1rem; }
    #paper {
      position:relative; flex:1;
      background:#fff8e7; border:2px solid #82C9A1;
      min-height:400px; resize:vertical; overflow:auto;
    }
    #assets { width:200px; background:#fafafa; border:2px solid #ddd; padding:.5rem; overflow:auto; }
    #assetList img { width:100%; margin-bottom:.5rem; cursor:grab; border:1px solid #ccc; border-radius:4px; }

    /* insert toolbar */
    #toolbar, #shapeMenu, #textToolbar { position:absolute; display:none; z-index:1000; }
    #toolbar {
      background:rgba(255,255,255,0.95); border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
    }
    #toolbar button, #shapeMenu button {
      display:flex; align-items:center; justify-content:center;
      border:none; cursor:pointer; background:#A8E6CF;
    }
    #toolbar button { width:36px; height:36px; border-radius:50%; }
    #shapeMenu button { width:32px; height:32px; border-radius:4px; }
    #toolbar button:hover, #shapeMenu button:hover { background:#76C69C; }
    #toolbar button img, #shapeMenu button img { width:20px; height:20px; }

    #shapeMenu {
      background:rgba(255,255,255,0.95); border:1px solid #ccc;
      border-radius:8px; padding:.25rem; display:flex; gap:.5rem;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
    }

    /* text toolbar */
    #textToolbar {
      background:#fff; border:1px solid #ccc; border-radius:4px;
      padding:.25rem; display:flex; gap:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:2000; white-space:nowrap;
    }
    #textToolbar button { background:transparent; border:none; cursor:pointer; }
    #textToolbar button img { width:20px; height:20px; }
    #textToolbar input { width:3rem; border:1px solid #ccc; border-radius:4px; padding:2px; }

    /* font wheel */
    #fontWheel {
      position:absolute; width:0; height:0; pointer-events:none;
      top:0; left:0; z-index:3000;
    }
    #fontWheel .fontOption {
      position:absolute; top:0; left:0;
      transform:translate(-50%,-50%);
      opacity:0;
      padding:.25rem .5rem;
      background:#fff; border:1px solid #ccc; border-radius:4px;
      white-space:nowrap;
      transition:transform .4s ease, opacity .4s ease;
      cursor:pointer;
    }
    /* fan‑out positions */
    #fontWheel.open .fontOption:nth-child(1) {
      transform:translate(-50%,-50%) translate(  0px,-60px); opacity:1;
    }
    #fontWheel.open .fontOption:nth-child(2) {
      transform:translate(-50%,-50%) translate( 52px,-36px); opacity:1;
    }
    #fontWheel.open .fontOption:nth-child(3) {
      transform:translate(-50%,-50%) translate( 52px, 36px); opacity:1;
    }
    #fontWheel.open .fontOption:nth-child(4) {
      transform:translate(-50%,-50%) translate(  0px, 60px); opacity:1;
    }
    #fontWheel.open .fontOption:nth-child(5) {
      transform:translate(-50%,-50%) translate(-52px,-36px); opacity:1;
    }

    /* handles */
    .resize-handle,.vertex-handle,.rotate-handle { display:none; }
    .resize-handle { position:absolute; width:10px; height:10px; background:#fff; border:1px solid #60A085; }
    .handle-nw { cursor:nwse-resize; top:-5px; left:-5px; }
    .handle-ne { cursor:nesw-resize; top:-5px; right:-5px; }
    .handle-sw { cursor:nesw-resize; bottom:-5px; left:-5px; }
    .handle-se { cursor:nwse-resize; bottom:-5px; right:-5px; }
    .vertex-handle {
      position:absolute; width:12px; height:12px; background:#fff;
      border:2px solid #60A085; border-radius:50%; cursor:move;
      margin:-6px 0 0 -6px;
    }
    .rotate-handle {
      position:absolute; top:-24px; left:50%; transform:translateX(-50%);
      width:12px; height:12px; background:#fff; border:2px solid #60A085;
      border-radius:50%; cursor:grab;
    }
    .element.selected .resize-handle,
    .shape-wrapper.selected .vertex-handle,
    .element.selected .rotate-handle {
      display:block !important;
    }

    /* elements */
    .element, .shape-wrapper { position:absolute; user-select:none; transform-origin:center; }
    .text-element {
      min-width:50px; min-height:20px; padding:.2rem;
      background:transparent; outline:none; cursor:text;
    }
    .shape-rect { width:100px; height:60px; background:rgba(96,160,133,0.3); border:2px solid #60A085; }
    .shape-circle { width:60px; height:60px; background:rgba(96,160,133,0.3); border:2px solid #60A085; border-radius:50%; }
    .image-wrapper {
      width:100px; height:100px; background-size:contain;
      background-repeat:no-repeat; background-position:center;
    }
    .shape-wrapper { background-color:transparent; }
  </style>
</head>
<body>
  <h1>Visual E‑Card Editor</h1>
  <div id="workspace">
    <div id="paper"></div>
    <div id="assets"><h2>Assets</h2><div id="assetList"></div></div>
  </div>

  <!-- insert toolbar -->
  <div id="toolbar">
    <button id="btnText" title="Add Text">T</button>
    <button id="btnImage" title="Add Image"><img src="image.svg" alt="Image"></button>
    <button id="btnShape" title="Add Shape"><img src="shapes.svg" alt="Shapes"></button>
  </div>

  <!-- shape menu -->
  <div id="shapeMenu">
    <button data-shape="rect"   title="Rectangle">◻</button>
    <button data-shape="circle" title="Circle">◯</button>
    <button data-shape="triangle" title="Triangle">△</button>
  </div>

  <!-- text toolbar -->
  <div id="textToolbar">
    <button id="tbBold"><b>B</b></button>
    <button id="tbItalic"><i>I</i></button>
    <button id="tbUnderline"><u>U</u></button>

    <button id="tbAlignLeft"   title="Align left"><img src="align-left.svg"   alt="Left"></button>
    <button id="tbAlignCenter" title="Align center"><img src="align-center.svg" alt="Center"></button>
    <button id="tbAlignRight"  title="Align right"><img src="align-right.svg"  alt="Right"></button>

    <button id="tbFont" title="Choose font">Aa</button>

    <input type="number" id="tbFontSize" min="8" max="72" title="Font Size">px
    <input type="color"  id="tbColor"      title="Text Color">
  </div>

  <!-- font wheel -->
  <div id="fontWheel">
    <button class="fontOption" data-font="Poppins"   style="font-family:'Poppins',sans-serif">Poppins</button>
    <button class="fontOption" data-font="Roboto"    style="font-family:'Roboto',sans-serif">Roboto</button>
    <button class="fontOption" data-font="Open Sans" style="font-family:'Open Sans',sans-serif">Open Sans</button>
    <button class="fontOption" data-font="Lora"      style="font-family:'Lora',serif">Lora</button>
    <button class="fontOption" data-font="Montserrat"style="font-family:'Montserrat',sans-serif">Montserrat</button>
  </div>

  <script>
  (function(){
    const paper       = document.getElementById('paper'),
          toolbar     = document.getElementById('toolbar'),
          shapeMenu   = document.getElementById('shapeMenu'),
          textToolbar = document.getElementById('textToolbar'),
          fontWheel   = document.getElementById('fontWheel'),
          assetList   = document.getElementById('assetList'),
          fontOpts    = fontWheel.querySelectorAll('.fontOption');
    let clickX=0, clickY=0, selectedEl=null;

    function rgbToHex(rgb){
      const [r,g,b]=rgb.match(/\d+/g).map(Number);
      return '#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);
    }

    function updateTextToolbarPosition(el){
      const rect   = el.getBoundingClientRect(),
            tbRect = textToolbar.getBoundingClientRect(),
            scrollY=window.scrollY,
            left   = rect.left + window.scrollX,
            topCand= scrollY + rect.top - tbRect.height - 8,
            top    = topCand < scrollY+8 ? scrollY+rect.bottom+8 : topCand;
      textToolbar.style.left = `${left}px`;
      textToolbar.style.top  = `${top}px`;
    }

    function deselect(){
      if(!selectedEl) return;
      selectedEl.classList.remove('selected');
      selectedEl = null;
      textToolbar.style.display = 'none';
    }

    function select(el){
      if(selectedEl===el) return;
      deselect();
      selectedEl = el;
      el.classList.add('selected');
      toolbar.style.display = 'none';
      shapeMenu.style.display = 'none';
      fontWheel.classList.remove('open');
      fontWheel.style.pointerEvents = 'none';

      if(el.classList.contains('text-element')){
        textToolbar.style.display = 'flex';
        updateTextToolbarPosition(el);
        document.getElementById('tbFontSize').value = parseInt(getComputedStyle(el).fontSize);
        document.getElementById('tbColor').value    = rgbToHex(getComputedStyle(el).color);
      }
    }

    paper.addEventListener('click', e=>{
      if(e.target===paper) deselect();
      clickX = e.offsetX; clickY = e.offsetY;
      const tbRect = toolbar.getBoundingClientRect();
      toolbar.style.left  = `${e.pageX - tbRect.width/2}px`;
      toolbar.style.top   = `${e.pageY - tbRect.height - 12}px`;
      toolbar.style.display = 'flex';
      shapeMenu.style.display = 'none';
      e.stopPropagation();
    });

    [toolbar, shapeMenu, textToolbar, fontWheel].forEach(el=>
      el.addEventListener('click', e=>e.stopPropagation())
    );
    document.addEventListener('click', ()=>{ 
      toolbar.style.display='none'; 
      shapeMenu.style.display='none'; 
      fontWheel.classList.remove('open');
      fontWheel.style.pointerEvents = 'none';
    });

    // insert actions
    document.getElementById('btnText').onclick = e=>{
      e.stopPropagation();
      const txt=document.createElement('div');
      txt.className='element text-element'; txt.contentEditable=true;
      txt.style.left=`${clickX}px`; txt.style.top=`${clickY}px`;
      txt.textContent='Enter text';
      paper.append(txt); initElement(txt,false); select(txt); txt.focus();
    };
    document.getElementById('btnImage').onclick = e=>{
      e.stopPropagation();
      const url=prompt('Enter image URL:'); if(!url) return;
      addAsset(url);
      const wrap=document.createElement('div');
      wrap.className='element image-wrapper';
      wrap.style.left=`${clickX}px`; wrap.style.top=`${clickY}px`;
      wrap.style.backgroundImage=`url(${url})`;
      paper.append(wrap); initElement(wrap,false); select(wrap);
    };
    document.getElementById('btnShape').onclick = e=>{
      e.stopPropagation();
      const r=e.currentTarget.getBoundingClientRect();
      shapeMenu.style.left=`${r.right+8}px`;
      shapeMenu.style.top=`${r.top}px`;
      shapeMenu.style.display='flex';
    };
    shapeMenu.addEventListener('click', e=>{
      const btn=e.target.closest('[data-shape]'); if(!btn) return;
      const t=btn. dataset.shape;
      if(t==='triangle') insertTriangle(); else insertBasic(t);
      shapeMenu.style.display='none';
    });

    // text toolbar
    document.getElementById('tbBold').onclick      = ()=> selectedEl && (selectedEl.style.fontWeight  = selectedEl.style.fontWeight==='bold'?'':'bold');
    document.getElementById('tbItalic').onclick    = ()=> selectedEl && (selectedEl.style.fontStyle   = selectedEl.style.fontStyle==='italic'?'':'italic');
    document.getElementById('tbUnderline').onclick = ()=> selectedEl && (selectedEl.style.textDecoration = selectedEl.style.textDecoration==='underline'?'':'underline');
    document.getElementById('tbAlignLeft').onclick   = ()=> selectedEl && (selectedEl.style.textAlign='left');
    document.getElementById('tbAlignCenter').onclick = ()=> selectedEl && (selectedEl.style.textAlign='center');
    document.getElementById('tbAlignRight').onclick  = ()=> selectedEl && (selectedEl.style.textAlign='right');
    document.getElementById('tbFontSize').oninput    = e=> selectedEl && (selectedEl.style.fontSize = e.target.value+'px');
    document.getElementById('tbColor').oninput       = e=> selectedEl && (selectedEl.style.color    = e.target.value);

    // font wheel
    document.getElementById('tbFont').addEventListener('click', e=>{
      e.stopPropagation();
      const br = e.currentTarget.getBoundingClientRect();
      fontWheel.style.left = `${br.left+br.width/2}px`;
      fontWheel.style.top  = `${br.top+br.height/2}px`;
      fontWheel.style.pointerEvents = 'auto';
      fontWheel.classList.toggle('open');
    });
    fontOpts.forEach(btn=>{
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const fam = btn.dataset.font;
        if(selectedEl && selectedEl.classList.contains('text-element')){
          selectedEl.style.fontFamily = `'${fam}',sans-serif`;
        }
        fontWheel.classList.remove('open');
        fontWheel.style.pointerEvents = 'none';
      });
    });

    // helpers...
    function addAsset(src){ /*…*/ }
    function insertBasic(type){ /*…*/ }
    function insertTriangle(){ /*…*/ }
    function initElement(el,isTri,poly){ /*…*/ }
    function makeDraggable(el){ /*…*/ }
    function enableDrop(el){ /*…*/ }
    function addResizeHandles(el){ /*…*/ }
    function startResize(dir,el){ /*…*/ }
    function addRotateHandle(el){ /*…*/ }
    function makeTriangleResizable(wrap,poly){ /*…*/ }

    // ... (rest of your helper implementations remain exactly as before) …
  })();
  </script>
</body>
</html>
