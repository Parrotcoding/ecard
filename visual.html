<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seafoam E‑Card Visual Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0; padding:1rem;
      background:#f0f0f0;
      font-family:'Poppins',sans-serif;
    }
    h1 { text-align:center; margin-bottom:1rem }

    #paper {
      position:relative;
      margin:auto;
      width:60vw;
      min-height:300px;
      background:#fff8e7;
      border:2px solid #82C9A1;
      resize:vertical;
      overflow:auto;
    }

    /* toolbar */
    #toolbar {
      position:absolute; display:none;
      background:rgba(255,255,255,0.95);
      border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:1000;
    }
    #toolbar button {
      width:32px; height:32px;
      border:none; border-radius:50%;
      background:#A8E6CF;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
    }
    #toolbar button:hover { background:#76C69C }
    #toolbar img { width:20px; height:20px }
    .icon-text { color:#fff; font-size:1rem; font-weight:700 }

    /* shapes submenu */
    #shapeMenu {
      position:absolute; display:none;
      background:rgba(255,255,255,0.95);
      border:1px solid #ccc; border-radius:8px;
      padding:.25rem; display:flex; gap:.5rem;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
      z-index:1001;
    }
    #shapeMenu button {
      width:32px; height:32px;
      border:none; border-radius:4px;
      background:#A8E6CF;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
    }
    #shapeMenu button:hover { background:#76C69C }

    /* resize handles (rect/circle) */
    .resize-handle {
      position:absolute; width:10px; height:10px;
      background:#fff; border:1px solid #60A085;
      z-index:10;
    }
    .handle-nw { cursor:nwse-resize; top:-5px; left:-5px }
    .handle-ne { cursor:nesw-resize; top:-5px; right:-5px }
    .handle-sw { cursor:nesw-resize; bottom:-5px; left:-5px }
    .handle-se { cursor:nwse-resize; bottom:-5px; right:-5px }

    /* triangle vertex handles */
    .vertex-handle {
      position:absolute; width:12px; height:12px;
      background:#fff; border:2px solid #60A085;
      border-radius:50%; z-index:10; cursor:move;
      margin:-6px 0 0 -6px;
    }

    /* elements */
    .element, .shape-wrapper {
      position:absolute; user-select:none;
    }
    .text-element {
      min-width:50px; min-height:20px;
      padding:.2rem; background:transparent; outline:none;
      cursor:text;
    }
    .shape-rect {
      width:100px; height:60px;
      background:rgba(96,160,133,0.3);
      border:2px solid #60A085;
    }
    .shape-circle {
      width:60px; height:60px;
      background:rgba(96,160,133,0.3);
      border:2px solid #60A085;
      border-radius:50%;
    }
  </style>
</head>
<body>
  <h1>Visual E‑Card Editor</h1>
  <div id="paper"></div>

  <!-- Toolbar -->
  <div id="toolbar">
    <button id="btnText"  title="Add Text"><span class="icon-text">T</span></button>
    <button id="btnImage" title="Add Image"><img src="image.svg" alt="Img"></button>
    <button id="btnShape" title="Add Shape"><img src="shapes.svg" alt="Shapes"></button>
  </div>

  <!-- Shapes submenu -->
  <div id="shapeMenu">
    <button data-shape="rect"     title="Rectangle">◻</button>
    <button data-shape="circle"   title="Circle">◯</button>
    <button data-shape="triangle" title="Triangle">△</button>
  </div>

  <script>
  (function(){
    const paper     = document.getElementById('paper');
    const toolbar   = document.getElementById('toolbar');
    const shapeMenu = document.getElementById('shapeMenu');
    let clickX=0, clickY=0;

    // Show toolbar above cursor
    paper.addEventListener('click', e=>{
      e.stopPropagation();
      clickX = e.offsetX; clickY = e.offsetY;
      const tb = toolbar.getBoundingClientRect();
      toolbar.style.left = (e.pageX - tb.width/2) + 'px';
      toolbar.style.top  = (e.pageY - tb.height - 12) + 'px';
      toolbar.style.display = 'flex';
      shapeMenu.style.display = 'none';
    });
    [toolbar, shapeMenu].forEach(el=>el.addEventListener('click', e=>e.stopPropagation()));
    document.addEventListener('click', ()=>{
      toolbar.style.display='none';
      shapeMenu.style.display='none';
    });

    // Add text
    document.getElementById('btnText').addEventListener('click', e=>{
      e.stopPropagation();
      const txt = document.createElement('div');
      txt.className = 'element text-element';
      txt.contentEditable = true;
      txt.style.left = clickX + 'px';
      txt.style.top  = clickY + 'px';
      txt.textContent = 'Enter text';
      paper.append(txt);
      makeDraggable(txt);
      toolbar.style.display='none';
      txt.focus();
    });

    // Add image
    document.getElementById('btnImage').addEventListener('click', e=>{
      e.stopPropagation();
      const url = prompt('Enter image URL:');
      if(!url) return;
      const img = document.createElement('img');
      img.className = 'element';
      img.src = url;
      img.style.left   = clickX + 'px';
      img.style.top    = clickY + 'px';
      img.style.height = '100px';
      paper.append(img);
      makeDraggable(img);
      makeResizable(img, false);
      toolbar.style.display='none';
    });

    // Show shape menu
    document.getElementById('btnShape').addEventListener('click', e=>{
      e.stopPropagation();
      const r = e.currentTarget.getBoundingClientRect();
      shapeMenu.style.left = r.right + 8 + 'px';
      shapeMenu.style.top  = r.top + 'px';
      shapeMenu.style.display='flex';
    });

    // Insert shapes
    shapeMenu.addEventListener('click', e=>{
      const btn = e.target.closest('[data-shape]');
      if(!btn) return;
      const type = btn.dataset.shape;
      if(type==='triangle') insertTriangle();
      else insertBasic(type);
      shapeMenu.style.display='none';
      toolbar.style.display='none';
    });

    function insertBasic(type){
      const el = document.createElement('div');
      el.className = 'element ' + (type==='rect'?'shape-rect':'shape-circle');
      el.style.left = clickX + 'px';
      el.style.top  = clickY + 'px';
      paper.append(el);
      makeDraggable(el);
      makeResizable(el, false);
    }

    function insertTriangle(){
      const wrap = document.createElement('div');
      wrap.className = 'shape-wrapper';
      wrap.style.left   = clickX +'px';
      wrap.style.top    = clickY +'px';
      wrap.style.width  = '80px';
      wrap.style.height = '70px';

      const svgNS="http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS,'svg');
      svg.setAttribute('width','100%');
      svg.setAttribute('height','100%');
      const poly = document.createElementNS(svgNS,'polygon');
      poly.setAttribute('points','0,70 40,0 80,70');
      poly.setAttribute('fill','rgba(96,160,133,0.3)');
      poly.setAttribute('stroke','#60A085');
      poly.setAttribute('stroke-width','2');
      svg.append(poly);
      wrap.append(svg);
      paper.append(wrap);

      makeDraggable(wrap);
      makeTriangleResizable(wrap, poly);
    }

    // Draggable
    function makeDraggable(el){
      let dx,dy;
      el.addEventListener('mousedown', e=>{
        if(e.target.matches('.resize-handle, .vertex-handle')) return;
        e.preventDefault();
        dx = e.clientX - el.offsetLeft;
        dy = e.clientY - el.offsetTop;
        document.addEventListener('mousemove', onmove);
        document.addEventListener('mouseup', ()=>document.removeEventListener('mousemove', onmove), { once:true });
      });
      function onmove(e){
        el.style.left = (e.clientX - dx)+'px';
        el.style.top  = (e.clientY - dy)+'px';
      }
    }

    // Rectangle/Circle resizing
    function makeResizable(el, tri){
      if(tri) return;
      ['nw','ne','sw','se'].forEach(dir=>{
        const h = document.createElement('div');
        h.className = 'resize-handle handle-'+dir;
        el.append(h);
        h.addEventListener('mousedown', startResize(dir, el));
      });
    }
    function startResize(dir, el){
      return function(e){
        e.stopPropagation(); e.preventDefault();
        const rect = el.getBoundingClientRect();
        const pRect= paper.getBoundingClientRect();
        const start = {
          x:e.clientX, y:e.clientY,
          left:rect.left-pRect.left, top:rect.top-pRect.top,
          w:rect.width, h:rect.height
        };
        document.addEventListener('mousemove', doResize);
        document.addEventListener('mouseup', ()=>document.removeEventListener('mousemove', doResize), {once:true});
        function doResize(ev){
          let dx = ev.clientX - start.x, dy = ev.clientY - start.y;
          let newL=start.left, newT=start.top, newW=start.w, newH=start.h;
          if(dir.includes('e')) newW = start.w + dx;
          if(dir.includes('s')) newH = start.h + dy;
          if(dir.includes('w')){
            newW = start.w - dx;
            newL = start.left + dx;
          }
          if(dir.includes('n')){
            newH = start.h - dy;
            newT = start.top + dy;
          }
          el.style.width  = newW + 'px';
          el.style.height = newH + 'px';
          el.style.left   = newL + 'px';
          el.style.top    = newT + 'px';
        }
      };
    }

    // Triangle vertex resizing with wrapper resizing
    function makeTriangleResizable(wrap, poly){
      let pts = [[0,70],[40,0],[80,70]];
      const handles = pts.map((_,i)=>{
        const h = document.createElement('div');
        h.className = 'vertex-handle';
        wrap.append(h);
        return h;
      });

      function update(){
        handles.forEach((h,i)=>{
          h.style.left = pts[i][0] + 'px';
          h.style.top  = pts[i][1] + 'px';
        });
        poly.setAttribute('points', pts.map(p=>p.join(',')).join(' '));
      }

      handles.forEach((h,i)=>{
        h.addEventListener('mousedown', e=>{
          e.stopPropagation(); e.preventDefault();
          const start = {
            x: e.clientX, y: e.clientY,
            wrapL: wrap.offsetLeft, wrapT: wrap.offsetTop,
            pts: pts.map(p=>p.slice())
          };
          document.addEventListener('mousemove', onDrag);
          document.addEventListener('mouseup', ()=>document.removeEventListener('mousemove', onDrag), { once:true });
          function onDrag(ev){
            const dx = ev.clientX - start.x, dy = ev.clientY - start.y;
            const abs = start.pts.map((p,j)=> j===i ? [p[0]+dx, p[1]+dy] : p );
            const xs = abs.map(p=>p[0]), ys=abs.map(p=>p[1]);
            const minX = Math.min(...xs), minY = Math.min(...ys);
            const maxX = Math.max(...xs), maxY = Math.max(...ys);
            pts = abs.map(p=>[p[0]-minX, p[1]-minY]);
            wrap.style.left   = start.wrapL + minX + 'px';
            wrap.style.top    = start.wrapT + minY + 'px';
            wrap.style.width  = (maxX - minX) + 'px';
            wrap.style.height = (maxY - minY) + 'px';
            update();
          }
        });
      });

      update();
    }

  })();
  </script>
</body>
</html>
